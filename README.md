# adEngine
基于Java开发广告引擎，最高可支持1百万广告数量，可支持每日千万级+请求流量。

# 设计理论基础
1. [广告系统架构设计](https://mp.weixin.qq.com/s/LN6NoToaVvORvZVd33xGdA)
2. 广告引擎实时索引设计

## 性能测试

### 1.测试方法

测试机器：MacBook Pro 2021 ，cpu Apple M1 Pro ，内存 16G。
通过10个定向维度进行测试，对以下内容进行基准测试：
1. 索引建立时间
2. 索引占用内存
3. 单次检索耗时

### 2.测试结果

#### 2.1 索引建立时间（毫秒）

##### Lucene
![lucene_benchmark](https://files.mdnice.com/user/11338/e9f673b9-69e9-4295-b778-d8c8a69d6645.png)
##### Trie
![trie_benchmark](https://files.mdnice.com/user/11338/7d78d06a-a56c-44ee-9fe3-0e524db508d0.png)
| 广告数量  | 索引建立时间(Lucene) | 索引建立时间(Trie) |
| --------- | -------------------- | ------------------ |
| 1,000     | 1 ms                 | 0.56 ms            |
| 10,000    | 14 ms                | 6 ms               |
| 100,000   | 147 ms               | 49 ms              |
| 1,000,000 | 3359 ms              | 853 ms             |

#### 2.2 索引占用内存

| 广告数量  | Lucene   | Trie     |
| --------- | -------- | -------- |
| 1,000     | 0.053 MB | 1.1 MB   |
| 10,000    | 0.36 MB  | 4.8 MB   |
| 100,000   | 3.5 MB   | 15.9 MB  |
| 1,000,000 | 36 MB    | 104.5 MB |

#### 2.3 单次检索耗时（微秒）

| 广告数量  | 单次检索(Lucene) | Trie     |
| --------- | ---------------- | -------- |
| 1,000     | 6.823 μs         | 0.194 μs |
| 10,000    | 1.757 μs         | 0.199 μs |
| 100,000   | 67.73 μs         | 0.198 μs |
| 1,000,000 | 3789.99 μs       | 0.203 μs |

### 3.测试结论

1. Trie 检索的时间复杂度不随数据量变化，只与检索的Term 数量有关，检索性能优异。
2. 随着数据量的增加，Trie 缺少一些数据压缩算法加持，内存占用相比Lucene没有很大的优势。
3. 十万级数量广告使用简易的Trie 作为检索结构非常合适，在百万级别以上时需要考虑更优化的数据压缩算法，否则有限考虑Lucene。

# Roadmap
![roadmap](https://user-images.githubusercontent.com/1421509/164683858-e20d915c-b208-4b59-87ad-55a0676210c2.png)
